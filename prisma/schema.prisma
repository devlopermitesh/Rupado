// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}



//////////////////////////////////////////////////
// USER (Clerk integrated)
//////////////////////////////////////////////////

model User {
  id              String   @id @default(uuid())
  clerkUserId     String   @unique

  firstName       String?
  lastName        String?
  email           String   @unique

  planType        PlanType @default(FREE)
  creditsRemaining Int     @default(10)

  totalCopied     Int     @default(0)

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  isActive        Boolean  @default(true)

  usages          PromptUsage[]
  subscriptions   Subscription[]
}

enum PlanType {
  FREE
  PAID
  PRO
}

//////////////////////////////////////////////////
// PROMPT
//////////////////////////////////////////////////

model Prompt {
  id          String   @id @default(uuid())

  title       String
  content     String
  steps       String?

  images      String[]   // store URLs

  copyCount   Int        @default(0)
  isTrending  Boolean    @default(false)

  createdBy   String     @default("admin")

  categoryId  String
  category    Category  @relation(fields: [categoryId], references: [id])

  tags        Tag[]

  usages      PromptUsage[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

//////////////////////////////////////////////////
// CATEGORY
//////////////////////////////////////////////////

model Category {
  id          String  @id @default(uuid())
  name        String  @unique
  description String?
  icon        String?

  prompts     Prompt[]
}

//////////////////////////////////////////////////
// TAG (many-to-many clean way)
//////////////////////////////////////////////////

model Tag {
  id      String   @id @default(uuid())
  name    String   @unique

  prompts Prompt[] 
}

//////////////////////////////////////////////////
// PROMPT USAGE (credits + analytics)
//////////////////////////////////////////////////

model PromptUsage {
  id        String   @id @default(uuid())

  userId    String
  promptId  String

  user      User   @relation(fields: [userId], references: [id])
  prompt    Prompt @relation(fields: [promptId], references: [id])

  copiedAt  DateTime @default(now())

  @@index([userId])
  @@index([promptId])
}

//////////////////////////////////////////////////
// SUBSCRIPTION (for Stripe etc later)
//////////////////////////////////////////////////

model Subscription {
  id        String   @id @default(uuid())

  userId    String
  user      User    @relation(fields: [userId], references: [id])

  plan      PlanType
  status    SubscriptionStatus

  startDate DateTime
  endDate   DateTime?

  createdAt DateTime @default(now())
}

enum SubscriptionStatus {
  ACTIVE
  CANCELED
  EXPIRED
}